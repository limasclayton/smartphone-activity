import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
sns.set()

# ml
from sklearn.preprocessing import StandardScaler
from sklearn.model_selection import train_test_split, RandomizedSearchCV
from sklearn.linear_model import LogisticRegression
from sklearn.pipeline import Pipeline
# variables
dataset_path = "input/smartphone_activity_dataset.csv"
RANDOM_STATE = 0

# reading data
df = pd.read_csv(dataset_path)

# PREPROCESS

# FEATURE ENGENIRING

# FEATURE SELECTION

# Selecting features with > 0.1 correlation with target and < 0.95 between themselves.
#features = ['feature_17', 'feature_68', 'feature_112', 'feature_536', 'feature_373', 'feature_376', 'feature_389', 'feature_93', 'feature_144', 'feature_358', 'feature_139', 'feature_178', 'feature_417', 'feature_551', 'feature_546', 'feature_334', 'feature_126', 'feature_292', 'feature_116', 'feature_40', 'feature_191', 'feature_403', 'feature_91', 'feature_451', 'feature_493', 'feature_117', 'feature_155', 'feature_237', 'feature_396', 'feature_133', 'feature_527', 'feature_151', 'feature_538', 'feature_134', 'feature_42', 'feature_490', 'feature_506', 'feature_18', 'feature_278', 'feature_337', 'feature_509', 'feature_4', 'feature_494', 'feature_58', 'feature_380', 'feature_263', 'feature_465', 'feature_477', 'feature_279', 'feature_304', 'feature_463', 'feature_466', 'feature_248', 'feature_97', 'feature_165', 'feature_119', 'feature_63', 'feature_149', 'feature_375', 'feature_26', 'feature_56', 'feature_38', 'feature_30', 'feature_436', 'feature_321', 'feature_41', 'feature_90', 'feature_210', 'feature_322', 'feature_331', 'feature_335', 'feature_86', 'feature_434', 'feature_166', 'feature_387', 'feature_137', 'feature_496', 'feature_43', 'feature_196', 'feature_262', 'feature_533', 'feature_299', 'feature_154', 'feature_109', 'feature_492', 'feature_200', 'feature_145', 'feature_437', 'feature_205', 'feature_507', 'feature_94', 'feature_24', 'feature_35', 'feature_23', 'feature_212', 'feature_138', 'feature_12', 'feature_286', 'feature_187', 'feature_332', 'feature_553', 'feature_120', 'feature_481', 'feature_526', 'feature_231', 'feature_98', 'feature_148', 'feature_467', 'feature_157', 'feature_479', 'feature_124', 'feature_143', 'feature_323', 'feature_195', 'feature_324', 'feature_535', 'feature_59', 'feature_179', 'feature_480', 'feature_454', 'feature_6', 'feature_118', 'feature_305', 'feature_307', 'feature_208', 'feature_160', 'feature_355', 'feature_236', 'feature_103', 'feature_111', 'feature_319', 'feature_34', 'feature_310', 'feature_520', 'feature_381', 'feature_379', 'feature_539', 'feature_388', 'feature_36', 'feature_545', 'feature_336', 'feature_25', 'feature_153', 'feature_495', 'feature_130', 'feature_333', 'feature_197', 'feature_317', 'feature_246', 'feature_320', 'feature_108', 'feature_152', 'feature_70', 'feature_293', 'feature_5', 'feature_28', 'feature_294', 'feature_19', 'feature_440', 'feature_296', 'feature_372', 'feature_475', 'feature_371', 'feature_99', 'feature_410', 'feature_402', 'feature_29', 'feature_438', 'feature_297', 'feature_257', 'feature_482', 'feature_79', 'feature_32', 'feature_64', 'feature_150', 'feature_359', 'feature_306', 'feature_476', 'feature_264', 'feature_146', 'feature_308', 'feature_309', 'feature_478', 'feature_77', 'feature_370', 'feature_280', 'feature_357', 'feature_192', 'feature_386', 'feature_401', 'feature_132', 'feature_115', 'feature_530', 'feature_468', 'feature_540', 'feature_159', 'feature_450', 'feature_318', 'feature_147', 'feature_125', 'feature_136', 'feature_113', 'feature_234', 'feature_295', 'feature_377', 'feature_512', 'feature_27', 'feature_374', 'feature_378', 'feature_213', 'feature_198', 'feature_164', 'feature_177', 'feature_514', 'feature_244', 'feature_338', 'feature_156', 'feature_406', 'feature_416', 'feature_491', 'feature_15', 'feature_239', 'feature_464', 'feature_462', 'feature_285', 'feature_31']
# Selecting 245 features with > 0.05 correlation with target and < 0.95 between themselves.
#features = ['feature_133', 'feature_479', 'feature_35', 'feature_285', 'feature_540', 'feature_279', 'feature_90', 'feature_126', 'feature_231', 'feature_136', 'feature_338', 'feature_178', 'feature_293', 'feature_265', 'feature_530', 'feature_111', 'feature_32', 'feature_130', 'feature_236', 'feature_4', 'feature_12', 'feature_308', 'feature_526', 'feature_309', 'feature_5', 'feature_495', 'feature_151', 'feature_357', 'feature_462', 'feature_79', 'feature_294', 'feature_198', 'feature_493', 'feature_374', 'feature_375', 'feature_144', 'feature_159', 'feature_296', 'feature_19', 'feature_535', 'feature_306', 'feature_332', 'feature_401', 'feature_187', 'feature_70', 'feature_125', 'feature_319', 'feature_450', 'feature_160', 'feature_527', 'feature_196', 'feature_132', 'feature_192', 'feature_40', 'feature_307', 'feature_76', 'feature_237', 'feature_65', 'feature_481', 'feature_389', 'feature_406', 'feature_466', 'feature_378', 'feature_248', 'feature_402', 'feature_490', 'feature_379', 'feature_149', 'feature_150', 'feature_551', 'feature_145', 'feature_295', 'feature_507', 'feature_26', 'feature_139', 'feature_148', 'feature_403', 'feature_246', 'feature_18', 'feature_36', 'feature_509', 'feature_63', 'feature_318', 'feature_164', 'feature_238', 'feature_302', 'feature_492', 'feature_208', 'feature_143', 'feature_25', 'feature_98', 'feature_80', 'feature_158', 'feature_480', 'feature_323', 'feature_137', 'feature_416', 'feature_113', 'feature_146', 'feature_478', 'feature_205', 'feature_438', 'feature_305', 'feature_24', 'feature_31', 'feature_333', 'feature_434', 'feature_15', 'feature_262', 'feature_153', 'feature_124', 'feature_123', 'feature_210', 'feature_257', 'feature_37', 'feature_43', 'feature_28', 'feature_317', 'feature_324', 'feature_147', 'feature_45', 'feature_396', 'feature_371', 'feature_335', 'feature_97', 'feature_33', 'feature_116', 'feature_177', 'feature_195', 'feature_463', 'feature_91', 'feature_467', 'feature_545', 'feature_200', 'feature_156', 'feature_165', 'feature_234', 'feature_115', 'feature_372', 'feature_387', 'feature_112', 'feature_546', 'feature_482', 'feature_193', 'feature_355', 'feature_457', 'feature_109', 'feature_138', 'feature_41', 'feature_119', 'feature_244', 'feature_437', 'feature_297', 'feature_370', 'feature_380', 'feature_514', 'feature_373', 'feature_58', 'feature_536', 'feature_120', 'feature_6', 'feature_496', 'feature_280', 'feature_520', 'feature_23', 'feature_30', 'feature_212', 'feature_264', 'feature_166', 'feature_310', 'feature_157', 'feature_107', 'feature_377', 'feature_152', 'feature_197', 'feature_239', 'feature_252', 'feature_134', 'feature_292', 'feature_334', 'feature_155', 'feature_179', 'feature_154', 'feature_286', 'feature_533', 'feature_538', 'feature_304', 'feature_464', 'feature_27', 'feature_17', 'feature_465', 'feature_359', 'feature_454', 'feature_99', 'feature_299', 'feature_337', 'feature_86', 'feature_34', 'feature_108', 'feature_117', 'feature_251', 'feature_213', 'feature_452', 'feature_512', 'feature_67', 'feature_38', 'feature_491', 'feature_46', 'feature_191', 'feature_388', 'feature_59', 'feature_94', 'feature_436', 'feature_451', 'feature_475', 'feature_336', 'feature_506', 'feature_118', 'feature_376', 'feature_322', 'feature_103', 'feature_477', 'feature_278', 'feature_331', 'feature_64', 'feature_476', 'feature_29', 'feature_73', 'feature_417', 'feature_263', 'feature_440', 'feature_494', 'feature_358', 'feature_321', 'feature_381', 'feature_320', 'feature_93', 'feature_539', 'feature_386', 'feature_410', 'feature_468', 'feature_553', 'feature_39', 'feature_56', 'feature_42']
# Selecting 354 features with > 0.05 correlation with target and < 0.98 between themselves.
#features = ['feature_528', 'feature_420', 'feature_406', 'feature_422', 'feature_115', 'feature_150', 'feature_526', 'feature_295', 'feature_192', 'feature_178', 'feature_210', 'feature_244', 'feature_16', 'feature_170', 'feature_251', 'feature_426', 'feature_181', 'feature_95', 'feature_136', 'feature_112', 'feature_541', 'feature_321', 'feature_475', 'feature_275', 'feature_185', 'feature_70', 'feature_107', 'feature_155', 'feature_33', 'feature_305', 'feature_402', 'feature_492', 'feature_478', 'feature_463', 'feature_119', 'feature_6', 'feature_425', 'feature_166', 'feature_391', 'feature_405', 'feature_278', 'feature_395', 'feature_486', 'feature_342', 'feature_212', 'feature_494', 'feature_151', 'feature_482', 'feature_548', 'feature_375', 'feature_265', 'feature_512', 'feature_208', 'feature_520', 'feature_331', 'feature_283', 'feature_324', 'feature_457', 'feature_379', 'feature_436', 'feature_280', 'feature_263', 'feature_67', 'feature_262', 'feature_500', 'feature_114', 'feature_464', 'feature_380', 'feature_165', 'feature_418', 'feature_523', 'feature_539', 'feature_113', 'feature_183', 'feature_313', 'feature_152', 'feature_191', 'feature_73', 'feature_237', 'feature_296', 'feature_376', 'feature_439', 'feature_495', 'feature_135', 'feature_105', 'feature_410', 'feature_400', 'feature_299', 'feature_452', 'feature_443', 'feature_382', 'feature_543', 'feature_132', 'feature_157', 'feature_233', 'feature_173', 'feature_256', 'feature_37', 'feature_538', 'feature_447', 'feature_42', 'feature_371', 'feature_444', 'feature_40', 'feature_164', 'feature_507', 'feature_448', 'feature_140', 'feature_160', 'feature_43', 'feature_4', 'feature_126', 'feature_388', 'feature_383', 'feature_477', 'feature_31', 'feature_30', 'feature_370', 'feature_211', 'feature_479', 'feature_111', 'feature_515', 'feature_320', 'feature_517', 'feature_294', 'feature_180', 'feature_5', 'feature_476', 'feature_510', 'feature_490', 'feature_144', 'feature_286', 'feature_91', 'feature_309', 'feature_390', 'feature_416', 'feature_56', 'feature_79', 'feature_197', 'feature_76', 'feature_110', 'feature_302', 'feature_252', 'feature_466', 'feature_549', 'feature_396', 'feature_80', 'feature_159', 'feature_18', 'feature_133', 'feature_373', 'feature_130', 'feature_336', 'feature_177', 'feature_29', 'feature_306', 'feature_238', 'feature_381', 'feature_142', 'feature_289', 'feature_137', 'feature_182', 'feature_205', 'feature_419', 'feature_522', 'feature_372', 'feature_179', 'feature_451', 'feature_86', 'feature_389', 'feature_318', 'feature_415', 'feature_292', 'feature_246', 'feature_116', 'feature_36', 'feature_141', 'feature_332', 'feature_118', 'feature_483', 'feature_28', 'feature_24', 'feature_297', 'feature_491', 'feature_12', 'feature_17', 'feature_506', 'feature_198', 'feature_489', 'feature_85', 'feature_327', 'feature_553', 'feature_124', 'feature_45', 'feature_231', 'feature_323', 'feature_277', 'feature_15', 'feature_41', 'feature_27', 'feature_92', 'feature_356', 'feature_433', 'feature_35', 'feature_480', 'feature_63', 'feature_213', 'feature_316', 'feature_172', 'feature_247', 'feature_207', 'feature_154', 'feature_26', 'feature_148', 'feature_58', 'feature_158', 'feature_310', 'feature_481', 'feature_493', 'feature_38', 'feature_61', 'feature_143', 'feature_529', 'feature_11', 'feature_32', 'feature_354', 'feature_21', 'feature_90', 'feature_109', 'feature_417', 'feature_248', 'feature_438', 'feature_532', 'feature_536', 'feature_308', 'feature_84', 'feature_23', 'feature_106', 'feature_145', 'feature_174', 'feature_101', 'feature_319', 'feature_230', 'feature_175', 'feature_196', 'feature_108', 'feature_241', 'feature_374', 'feature_264', 'feature_22', 'feature_359', 'feature_328', 'feature_533', 'feature_334', 'feature_147', 'feature_64', 'feature_187', 'feature_39', 'feature_153', 'feature_123', 'feature_290', 'feature_34', 'feature_186', 'feature_467', 'feature_551', 'feature_423', 'feature_357', 'feature_46', 'feature_509', 'feature_139', 'feature_285', 'feature_138', 'feature_93', 'feature_134', 'feature_94', 'feature_387', 'feature_195', 'feature_304', 'feature_25', 'feature_440', 'feature_184', 'feature_59', 'feature_236', 'feature_176', 'feature_239', 'feature_454', 'feature_200', 'feature_202', 'feature_434', 'feature_209', 'feature_338', 'feature_234', 'feature_65', 'feature_131', 'feature_367', 'feature_194', 'feature_496', 'feature_276', 'feature_98', 'feature_535', 'feature_386', 'feature_268', 'feature_279', 'feature_333', 'feature_146', 'feature_409', 'feature_62', 'feature_358', 'feature_337', 'feature_401', 'feature_293', 'feature_14', 'feature_377', 'feature_13', 'feature_156', 'feature_19', 'feature_465', 'feature_120', 'feature_403', 'feature_527', 'feature_468', 'feature_554', 'feature_514', 'feature_307', 'feature_339', 'feature_450', 'feature_335', 'feature_99', 'feature_424', 'feature_378', 'feature_257', 'feature_317', 'feature_435', 'feature_322', 'feature_546', 'feature_190', 'feature_171', 'feature_445', 'feature_102', 'feature_103', 'feature_287', 'feature_69', 'feature_193', 'feature_437', 'feature_355', 'feature_125', 'feature_149', 'feature_117', 'feature_540', 'feature_446', 'feature_97', 'feature_392', 'feature_462', 'feature_259']
# Selecting 407 features with > 0.05 correlation with target and < 0.99 between themselves.
features = ['feature_192', 'feature_31', 'feature_42', 'feature_406', 'feature_314', 'feature_103', 'feature_485', 'feature_452', 'feature_420', 'feature_528', 'feature_381', 'feature_233', 'feature_439', 'feature_266', 'feature_33', 'feature_328', 'feature_336', 'feature_91', 'feature_303', 'feature_481', 'feature_261', 'feature_132', 'feature_228', 'feature_468', 'feature_279', 'feature_281', 'feature_113', 'feature_426', 'feature_198', 'feature_489', 'feature_64', 'feature_148', 'feature_171', 'feature_166', 'feature_483', 'feature_98', 'feature_519', 'feature_14', 'feature_384', 'feature_354', 'feature_409', 'feature_284', 'feature_56', 'feature_472', 'feature_4', 'feature_359', 'feature_67', 'feature_190', 'feature_382', 'feature_411', 'feature_209', 'feature_12', 'feature_410', 'feature_290', 'feature_70', 'feature_187', 'feature_390', 'feature_435', 'feature_440', 'feature_10', 'feature_22', 'feature_498', 'feature_186', 'feature_251', 'feature_415', 'feature_126', 'feature_514', 'feature_388', 'feature_476', 'feature_246', 'feature_153', 'feature_85', 'feature_34', 'feature_480', 'feature_92', 'feature_123', 'feature_105', 'feature_418', 'feature_35', 'feature_104', 'feature_535', 'feature_164', 'feature_238', 'feature_424', 'feature_368', 'feature_334', 'feature_97', 'feature_63', 'feature_213', 'feature_465', 'feature_497', 'feature_200', 'feature_131', 'feature_157', 'feature_283', 'feature_475', 'feature_11', 'feature_338', 'feature_159', 'feature_493', 'feature_462', 'feature_277', 'feature_293', 'feature_335', 'feature_502', 'feature_524', 'feature_526', 'feature_248', 'feature_378', 'feature_463', 'feature_268', 'feature_554', 'feature_539', 'feature_257', 'feature_179', 'feature_467', 'feature_422', 'feature_478', 'feature_461', 'feature_19', 'feature_150', 'feature_173', 'feature_369', 'feature_278', 'feature_110', 'feature_374', 'feature_194', 'feature_443', 'feature_136', 'feature_322', 'feature_546', 'feature_210', 'feature_387', 'feature_389', 'feature_193', 'feature_402', 'feature_156', 'feature_280', 'feature_114', 'feature_448', 'feature_344', 'feature_288', 'feature_545', 'feature_400', 'feature_470', 'feature_327', 'feature_265', 'feature_323', 'feature_170', 'feature_61', 'feature_294', 'feature_235', 'feature_509', 'feature_433', 'feature_41', 'feature_298', 'feature_252', 'feature_40', 'feature_96', 'feature_5', 'feature_320', 'feature_46', 'feature_432', 'feature_101', 'feature_451', 'feature_332', 'feature_553', 'feature_446', 'feature_20', 'feature_57', 'feature_380', 'feature_154', 'feature_151', 'feature_18', 'feature_383', 'feature_39', 'feature_297', 'feature_500', 'feature_377', 'feature_302', 'feature_68', 'feature_275', 'feature_331', 'feature_26', 'feature_436', 'feature_237', 'feature_445', 'feature_37', 'feature_24', 'feature_262', 'feature_491', 'feature_185', 'feature_307', 'feature_379', 'feature_95', 'feature_118', 'feature_486', 'feature_507', 'feature_204', 'feature_191', 'feature_177', 'feature_181', 'feature_112', 'feature_86', 'feature_73', 'feature_134', 'feature_536', 'feature_523', 'feature_259', 'feature_244', 'feature_550', 'feature_65', 'feature_23', 'feature_116', 'feature_529', 'feature_490', 'feature_135', 'feature_356', 'feature_522', 'feature_160', 'feature_397', 'feature_107', 'feature_140', 'feature_370', 'feature_45', 'feature_492', 'feature_141', 'feature_403', 'feature_176', 'feature_30', 'feature_289', 'feature_263', 'feature_479', 'feature_183', 'feature_454', 'feature_414', 'feature_79', 'feature_395', 'feature_145', 'feature_340', 'feature_76', 'feature_264', 'feature_84', 'feature_339', 'feature_94', 'feature_404', 'feature_375', 'feature_318', 'feature_292', 'feature_108', 'feature_58', 'feature_376', 'feature_437', 'feature_538', 'feature_551', 'feature_125', 'feature_212', 'feature_474', 'feature_510', 'feature_337', 'feature_27', 'feature_364', 'feature_386', 'feature_158', 'feature_313', 'feature_316', 'feature_401', 'feature_308', 'feature_416', 'feature_482', 'feature_396', 'feature_299', 'feature_457', 'feature_458', 'feature_499', 'feature_236', 'feature_211', 'feature_276', 'feature_152', 'feature_25', 'feature_286', 'feature_62', 'feature_6', 'feature_115', 'feature_512', 'feature_124', 'feature_330', 'feature_310', 'feature_133', 'feature_357', 'feature_147', 'feature_385', 'feature_296', 'feature_109', 'feature_496', 'feature_532', 'feature_239', 'feature_119', 'feature_172', 'feature_59', 'feature_137', 'feature_471', 'feature_447', 'feature_304', 'feature_506', 'feature_196', 'feature_208', 'feature_444', 'feature_285', 'feature_425', 'feature_464', 'feature_549', 'feature_295', 'feature_537', 'feature_391', 'feature_466', 'feature_365', 'feature_305', 'feature_317', 'feature_180', 'feature_230', 'feature_309', 'feature_120', 'feature_165', 'feature_43', 'feature_256', 'feature_355', 'feature_149', 'feature_117', 'feature_484', 'feature_540', 'feature_241', 'feature_358', 'feature_111', 'feature_36', 'feature_139', 'feature_197', 'feature_174', 'feature_324', 'feature_260', 'feature_143', 'feature_511', 'feature_93', 'feature_28', 'feature_527', 'feature_178', 'feature_69', 'feature_372', 'feature_419', 'feature_405', 'feature_477', 'feature_38', 'feature_300', 'feature_434', 'feature_80', 'feature_287', 'feature_247', 'feature_438', 'feature_373', 'feature_231', 'feature_366', 'feature_548', 'feature_102', 'feature_254', 'feature_341', 'feature_205', 'feature_306', 'feature_15', 'feature_182', 'feature_392', 'feature_29', 'feature_234', 'feature_17', 'feature_399', 'feature_155', 'feature_90', 'feature_146', 'feature_207', 'feature_202', 'feature_32', 'feature_106', 'feature_130', 'feature_321', 'feature_142', 'feature_184', 'feature_319', 'feature_417', 'feature_450', 'feature_144', 'feature_333', 'feature_520', 'feature_515', 'feature_99', 'feature_195', 'feature_371', 'feature_100', 'feature_495', 'feature_533', 'feature_494', 'feature_541', 'feature_243', 'feature_175', 'feature_342', 'feature_21', 'feature_138', 'feature_16', 'feature_13']
X = df[features]
# Selecting all features
#X = df.drop('activity', axis=1)
y = df.activity
X_train, X_test, y_train, y_test = train_test_split(X, y, stratify=y, test_size=0.3, random_state=RANDOM_STATE)
print(X_train.shape)
print(X_test.shape)

# MODEL

# logistic pipeline
lr_pipe = Pipeline([
    ('scaler', StandardScaler()),
    ('classifier', LogisticRegression())
    ])

param_grid = [
    {'classifier__random_state' : [RANDOM_STATE]}
    ]

lr_cv = RandomizedSearchCV(lr_pipe, param_grid, n_jobs=-1, cv=10, random_state=RANDOM_STATE)
lr_cv.fit(X_train, y_train)

print('-' * 100)
print('Logistic Regression pipeline train score: {:.3f}'.format(lr_cv.score(X_train, y_train)))
print('Logistic Regression pipeline test score: {:.3f}'.format(lr_cv.score(X_test, y_test)))
print('Logistic Regression pipelinepeline Best score: {0}'.format(lr_cv.best_score_))
print('Logistic Regression pipeline best params: {0}'.format(lr_cv.best_params_))
print('Logistic Regression pipeline coeficients: {0}'.format(lr_cv.best_estimator_.named_steps['classifier'].coef_))